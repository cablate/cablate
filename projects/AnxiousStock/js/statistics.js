import{formatCurrency,formatPercentage,getProfitLossClass}from"./utils.js";import{getLiquidationHistory,getTotalProfitLoss}from"./playHistory.js";let elements={statsModal:null,totalLiquidations:null,avgCandleCount:null,totalCandleCount:null,totalProfitLoss:null,recentLiquidations:null,closeStatsBtn:null,statsTab1:null,statsTab2:null,statsTabContent1:null,statsTabContent2:null};function initStatistics(){elements.statsModal=document.getElementById("statsModal"),elements.totalLiquidations=document.getElementById("totalLiquidations"),elements.avgCandleCount=document.getElementById("avgCandleCount"),elements.totalCandleCount=document.getElementById("totalCandleCount"),elements.totalProfitLoss=document.getElementById("totalProfitLoss"),elements.recentLiquidations=document.getElementById("recentLiquidations"),elements.closeStatsBtn=document.getElementById("closeStatsBtn"),elements.statsTab1=document.getElementById("statsTab1"),elements.statsTab2=document.getElementById("statsTab2"),elements.statsTabContent1=document.getElementById("statsTabContent1"),elements.statsTabContent2=document.getElementById("statsTabContent2"),elements.closeStatsBtn.addEventListener("click",hideStatsModal),elements.statsTab1.addEventListener("click",(()=>switchTab(1))),elements.statsTab2.addEventListener("click",(()=>switchTab(2))),elements.statsModal.addEventListener("click",(t=>{t.target===elements.statsModal&&hideStatsModal()}))}function switchTab(t){elements.statsTab1.classList.remove("active"),elements.statsTab2.classList.remove("active"),elements.statsTabContent1.classList.remove("active"),elements.statsTabContent2.classList.remove("active"),1===t?(elements.statsTab1.classList.add("active"),elements.statsTabContent1.classList.add("active")):2===t&&(elements.statsTab2.classList.add("active"),elements.statsTabContent2.classList.add("active"))}function showStatsModal(){updateStatistics(),elements.statsModal.style.display="flex",switchTab(1)}function hideStatsModal(){elements.statsModal.style.display="none"}function updateStatistics(){const t=getLiquidationHistory();if(0===t.length)return elements.totalLiquidations.textContent="0",elements.avgCandleCount.textContent="0",elements.totalCandleCount.textContent="0",elements.totalProfitLoss.textContent="0",void(elements.recentLiquidations.innerHTML='<div class="no-data">暫無清倉記錄</div>');const e=t.length,s=t.reduce(((t,e)=>t+e.candleCount),0),n=s/e,a=getTotalProfitLoss();elements.totalLiquidations.textContent=e,elements.avgCandleCount.textContent=n.toFixed(1),elements.totalCandleCount.textContent=s,elements.totalProfitLoss.textContent=formatCurrency(a),elements.totalProfitLoss.className="value "+getProfitLossClass(a),updateRecentLiquidations(t)}function updateRecentLiquidations(t){elements.recentLiquidations.innerHTML="";const e=[...t].reverse().slice(0,10);e.forEach((t=>{const e=document.createElement("div");e.className="liquidation-record "+getProfitLossClass(t.profitLossPercentage);const s=new Date(t.timestamp),n=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}-${s.getDate().toString().padStart(2,"0")} ${s.getHours().toString().padStart(2,"0")}:${s.getMinutes().toString().padStart(2,"0")}`,a=t.profitLoss;e.innerHTML=`\n            <div class="record-info">\n                <div class="date">${n}</div>\n                <div class="candle-count">K線數: ${t.candleCount}</div>\n            </div>\n            <div class="profit-loss ${getProfitLossClass(t.profitLossPercentage)}">\n                ${formatPercentage(t.profitLossPercentage)}\n                <div class="profit-loss-amount">${formatCurrency(a)}</div>\n            </div>\n        `,elements.recentLiquidations.appendChild(e)})),0===e.length&&(elements.recentLiquidations.innerHTML='<div class="no-data">暫無清倉記錄</div>')}function setupStatsButton(t){t&&t.addEventListener("click",showStatsModal)}export{initStatistics,showStatsModal,hideStatsModal,setupStatsButton};